CREATE TABLE TEACHERS (
    DOCUMENT_ID VARCHAR2(20) PRIMARY KEY,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    LAST_NAME VARCHAR2(50) NOT NULL,
    PHONE_NUMBER VARCHAR2(20),
    EMAIL VARCHAR2(100),
    ACTIVE CHAR(1) DEFAULT 'Y' CHECK (ACTIVE IN ('Y', 'N'))
);


CREATE TABLE COURSES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NAME_COURSE VARCHAR2(50) NOT NULL,
    MIN_AGE_MONTHS NUMBER(3) NOT NULL,
    MAX_AGE_MONTHS NUMBER(3) NOT NULL,
    MAX_CAPACITY NUMBER(3) NOT NULL,
    SHIFT VARCHAR2(20), -- 'Morning', 'Afternoon', 'Full Day'
    MAIN_TEACHER_ID VARCHAR2(20) ,
    LOCATION VARCHAR2(100),
    ACTIVE CHAR(1) DEFAULT 'Y' CHECK (ACTIVE IN ('Y', 'N')),
    CONSTRAINT FK_COURSES_TEACHER FOREIGN KEY (MAIN_TEACHER_ID) REFERENCES TEACHERS(DOCUMENT_ID)
);


CREATE TABLE CHILDREN (
    DOCUMENT_ID VARCHAR2(20) PRIMARY KEY,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    LAST_NAME VARCHAR2(50) NOT NULL,
    BIRTH_DATE DATE NOT NULL,
    GENDER VARCHAR(20) CHECK (GENDER IN ('MASCULINO', 'FEMENINO')),
    MEDICAL_NOTES VARCHAR2(200),
    ALLERGIES VARCHAR2(100)
);

CREATE TABLE GUARDIANS (
    DOCUMENT_ID VARCHAR2(20) PRIMARY KEY,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    LAST_NAME VARCHAR2(50) NOT NULL,
    RELATIONSHIP VARCHAR2(20),
    PHONE_NUMBER VARCHAR2(20),
    EMAIL VARCHAR2(100)
);


CREATE TABLE ENROLLMENTS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CHILD_ID VARCHAR2(20) NOT NULL,
    GUARDIAN_ID VARCHAR2(20) NOT NULL,
    COURSE_ID NUMBER NOT NULL,
    ENROLL_DATE DATE DEFAULT SYSDATE,
    STATUS_ENROLLMENT VARCHAR2(20) DEFAULT 'Pending',
    CONSTRAINT FK_ENROLL_CHILD FOREIGN KEY (CHILD_ID) REFERENCES CHILDREN(DOCUMENT_ID),
    CONSTRAINT FK_ENROLL_GUARDIAN FOREIGN KEY (GUARDIAN_ID) REFERENCES GUARDIANS(DOCUMENT_ID),
    CONSTRAINT FK_ENROLL_COURSE FOREIGN KEY (COURSE_ID) REFERENCES COURSES(ID)
);


CREATE TABLE DOCUMENTS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ENROLLMENT_ID NUMBER NOT NULL,
    FILE_NAME VARCHAR2(100),
    FILE_URI VARCHAR(500),
    FILE_TYPE VARCHAR2(50), -- ej: 'dni_child', 'dni_guardian', 'vaccination_card', etc.
    FILE_CONTENT BLOB, -- si los guard√°s en base de datos (alternativa: solo ruta del archivo)
    UPLOAD_DATE DATE DEFAULT SYSDATE,
    CONSTRAINT FK_DOC_ENROLL FOREIGN KEY (ENROLLMENT_ID) REFERENCES ENROLLMENTS(ID)
);


CREATE TABLE USERS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DOCUMENT_ID VARCHAR2(50) UNIQUE NOT NULL,
    PASSWORD_HASH VARCHAR2(255) NOT NULL,
    ROLE VARCHAR2(20) NOT NULL, -- 'ADMIN', 'TEACHER', 'GUARDIAN', etc.
    ACTIVE CHAR(1) DEFAULT 'Y' CHECK (ACTIVE IN ('Y', 'N')),
    CREATED_AT DATE DEFAULT SYSDATE
);


CREATE TABLE roles (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
   name VARCHAR(50) UNIQUE NOT NULL
);


CREATE TABLE user_roles (
  user_id NUMBER,
  role_id NUMBER,
  PRIMARY KEY (user_id, role_id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (role_id) REFERENCES roles(id)
);